Project Driveapp {
    database_type: 'mongodb'
    Note: '''
    # DriveApp Database Schema (MongoDB) - MVP Version

    A file and media management platform database structure supporting:
    - User authentication and authorization
    - File upload and management
    - Folder organization (hierarchical)
    - Secure file access with temporary URLs
    - File metadata tracking

    ## Key Features
    - JWT-based authentication
    - Cloud storage integration (Azure Blob Storage preferred)
    - File type validation and size limits
    - Hierarchical folder structure
    - Secure file access URLs with expiration
    - MongoDB-native design with references
    '''
}

// ========================================
// USER MANAGEMENT
// ========================================

Table users {
    _id ObjectId [primary key]
    email string [not null, unique, note: 'User email for authentication']
    password_hash string [not null, note: 'Hashed password using bcrypt']
    full_name string [not null, note: 'User full name']
    avatar_url string [note: 'Optional avatar image URL']
    is_active boolean [not null, default: true, note: 'Account status']
    email_verified boolean [not null, default: false, note: 'Email verification status']
    last_login_at date [note: 'Last login timestamp']
    created_at date [not null, default: `new Date()`]
    updated_at date [not null, default: `new Date()`]

    indexes {
        email [unique]
        created_at [name: 'idx_users_created_at']
    }

    Note: 'Stores user account information and authentication data'
}

Table user_sessions {
    _id ObjectId [primary key]
    user_id ObjectId [not null, ref: > users._id]
    token_hash string [not null, note: 'Hashed JWT token']
    expires_at date [not null, note: 'Token expiration time']
    ip_address string [note: 'IP address of the session']
    user_agent string [note: 'Browser/user agent information']
    is_active boolean [not null, default: true, note: 'Session status']
    created_at date [not null, default: `new Date()`]

    indexes {
        user_id [name: 'idx_user_sessions_user_id']
        token_hash [unique]
        expires_at [name: 'idx_user_sessions_expires_at']
    }

    Note: 'Stores active user sessions for JWT token management'
}

// ========================================
// FOLDER MANAGEMENT
// ========================================

Table folders {
    _id ObjectId [primary key]
    name string [not null, note: 'Folder name']
    user_id ObjectId [not null, ref: > users._id]
    parent_folder_id ObjectId [ref: > folders._id, note: 'Parent folder for hierarchical structure']
    path string [not null, note: 'Full path from root (e.g., /Documents/Work)']
    is_root boolean [not null, default: false, note: 'Whether this is a root folder']
    created_at date [not null, default: `new Date()`]
    updated_at date [not null, default: `new Date()`]

    indexes {
        user_id [name: 'idx_folders_user_id']
        parent_folder_id [name: 'idx_folders_parent_id']
        (user_id, path) [unique, name: 'idx_folders_user_path_unique']
    }

    Note: 'Stores folder structure with hierarchical organization per user'
}

// ========================================
// FILE MANAGEMENT
// ========================================

Table files {
    _id ObjectId [primary key]
    original_name string [not null, note: 'Original file name as uploaded']
    server_name string [not null, note: 'Generated server-side file name']
    mime_type string [not null, note: 'File MIME type (e.g., image/jpeg)']
    size number [not null, note: 'File size in bytes']
    access_url string [note: 'Temporary access URL for file download']
    access_url_expires_at date [note: 'When the access URL expires']
    user_id ObjectId [not null, ref: > users._id]
    folder_id ObjectId [ref: > folders._id, note: 'Folder where file is located (optional)']
    storage_path string [not null, note: 'Path in cloud storage (e.g., Azure Blob)']
    storage_provider string [not null, default: 'azure', note: 'Cloud storage provider']
    checksum string [note: 'File checksum for integrity verification']
    is_public boolean [not null, default: false, note: 'Whether file is publicly accessible']
    upload_date date [not null, default: `new Date()`]
    last_accessed_at date [note: 'Last time file was accessed']
    created_at date [not null, default: `new Date()`]
    updated_at date [not null, default: `new Date()`]

    indexes {
        user_id [name: 'idx_files_user_id']
        folder_id [name: 'idx_files_folder_id']
        mime_type [name: 'idx_files_mime_type']
        upload_date [name: 'idx_files_upload_date']
        (user_id, original_name) [name: 'idx_files_user_original_name']
    }

    Note: 'Stores file metadata and cloud storage information'
}

// ========================================
// FILE SHARING & ACCESS CONTROL
// ========================================

Table file_shares {
    _id ObjectId [primary key]
    file_id ObjectId [not null, ref: > files._id]
    shared_by_user_id ObjectId [not null, ref: > users._id, note: 'User who shared the file']
    shared_with_user_id ObjectId [ref: > users._id, note: 'User with whom file is shared (optional)']
    access_token string [unique, note: 'Token for public access']
    access_level string [not null, default: 'read', note: 'read, write, admin']
    expires_at date [note: 'When the share expires']
    is_active boolean [not null, default: true]
    created_at date [not null, default: `new Date()`]

    indexes {
        file_id [name: 'idx_file_shares_file_id']
        shared_by_user_id [name: 'idx_file_shares_shared_by']
        shared_with_user_id [name: 'idx_file_shares_shared_with']
        access_token [unique]
    }

    Note: 'Manages file sharing between users and public access tokens'
}

TableGroup user_management [color: #3498DB, note: 'User authentication and account management'] {
    users
    user_sessions
}

TableGroup file_management [color: #2ECC71, note: 'File storage and organization'] {
    files
    folders
    file_shares
}

// ========================================
// NOTES
// ========================================

Note system_notes {
'''
## MongoDB Implementation Notes - MVP Version

### Core Features (MVP Requirements)
- User authentication with JWT tokens
- File upload with cloud storage integration
- Folder hierarchy management
- File sharing and access control
- Basic file metadata storage

### Security Considerations
- All passwords are hashed using bcrypt
- JWT tokens are stored as hashes in user_sessions
- File access URLs have expiration times
- User isolation (users can only access their own files)

### Performance Optimizations
- Indexes on frequently queried fields
- Compound indexes for user-specific queries
- Efficient folder hierarchy with path-based queries

### Cloud Storage Integration
- Supports Azure Blob Storage (preferred)
- File metadata stored in MongoDB, actual files in cloud
- Checksum verification for file integrity

### Rate Limiting (Redis)
- Rate limiting handled by Redis (not in MongoDB)
- Temporary access URL caching in Redis
- Upload progress handled in frontend state

### MongoDB Best Practices
- Use ObjectId as primary keys
- Use references (ObjectId) for relationships
- Index frequently queried fields
- Use compound indexes for multi-field queries
- Consider TTL indexes for session expiration

### Removed Features (Not in MVP)
- Upload session tracking (handled by Redis + frontend)
- Complex audit logging (basic logging sufficient)
- Embedded documents (keeping it simple)
- Advanced metadata (basic file info only)
'''
}
